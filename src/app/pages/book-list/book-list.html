<div class="container my-4">
  <h2 class="mb-4">Book List</h2>

  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <div *ngFor="let book of books" class="card mb-3 shadow-sm">
    <div class="card-body d-flex justify-content-between align-items-start">
      <div>
        <h5 class="card-title">{{ book.name }}</h5>
        <p class="card-text">Quantity: {{ book.quantity }}</p>
        <span class="badge" [ngClass]="{
          'bg-success': book.quantity > 0,
          'bg-danger': book.quantity <= 0
        }">
          {{ book.quantity > 0 ? 'Available' : 'Not Available' }}
        </span>
      </div>

      <div class="d-flex gap-2 flex-column flex-md-row align-items-start align-items-md-center">

       <!-- Borrow Button -->
<button 
  *ngIf="book.quantity > 0 && !hasBorrowedThisBook(book.id) && !hasAnyBorrowedBook()" 
  (click)="borrow(book.id)" 
  class="btn btn-outline-primary btn-sm">
  <i class="bi bi-arrow-down-circle"></i> Borrow
</button>

<!-- Return Button -->
<button 
  *ngIf="hasBorrowedThisBook(book.id)" 
  (click)="return(book.id)" 
  class="btn btn-outline-warning btn-sm">
  <i class="bi bi-arrow-return-left"></i> Return
</button>

        <button *ngIf="isAdmin && editModeId !== book.id"
                class="btn btn-outline-danger btn-sm" 
                (click)="deleteBook(book.id)">
          <i class="bi bi-trash"></i> Delete
        </button>

        <button *ngIf="isAdmin && editModeId !== book.id"
                class="btn btn-outline-info btn-sm"
                (click)="startEdit(book)">
          <i class="bi bi-pencil"></i> Edit
        </button>

    
        <div *ngIf="editModeId === book.id" class="w-100">
          <form (ngSubmit)="saveEdit()" class="d-flex flex-column flex-md-row gap-2 align-items-start align-items-md-center">
            <input
              [(ngModel)]="editBookData.name"
              name="editName{{book.id}}"
              class="form-control mb-2 mb-md-0"
              placeholder="Book Name"
              required
            />
            <input
              [(ngModel)]="editBookData.quantity"
              name="editQuantity{{book.id}}"
              type="number"
              class="form-control mb-2 mb-md-0"
              placeholder="Quantity"
              required
              min="1"
            />
            <button type="submit" class="btn btn-success btn-sm me-2">Save</button>
            <button type="button" class="btn btn-secondary btn-sm" (click)="cancelEdit()">Cancel</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>